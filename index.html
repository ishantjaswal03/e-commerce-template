<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern E-Commerce Template</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Modern Header Styling */
        #main-header {
            transition: background-color 0.4s ease-out, box-shadow 0.4s ease-out;
        }
        #main-header a, #main-header button, #main-header i {
            transition: color 0.4s ease-out;
        }
        .header-scrolled {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .header-scrolled a, .header-scrolled button, .header-scrolled i {
             color: #1f2937; /* gray-800 */
        }
        .header-scrolled a:hover, .header-scrolled button:hover {
            color: #db2777; /* pink-600 */
        }
        .header-scrolled #header-search-bar {
            color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }
        .header-scrolled #header-search-bar::placeholder {
            color: #6b7280; /* gray-500 */
        }
        
        /* Custom scrollbar hiding utility */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Modal & Sidebar Styles */
        .modal, #cart-sidebar, #wishlist-sidebar { transition: transform 0.3s ease-in-out; }
        .modal-overlay, #cart-overlay, #wishlist-overlay { transition: opacity 0.3s ease-in-out; }
        
        /* Toast Notification */
        #toast { transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; }

        /* Category Styling */
        .category-item.active-category .relative > div:last-child {
             outline: 4px solid #db2777;
             outline-offset: -4px;
        }
        .category-item.active-category .relative { 
            transform: scale(1.05); 
        }

        /* Loader styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #db2777;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Modern Header -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo -->
                <a href="#" class="text-3xl font-bold text-white">YourLogo</a>
                
                <div id="header-main-content" class="flex items-center justify-end flex-grow">
                    <!-- Desktop Navigation -->
                    <nav class="hidden md:flex items-center space-x-10 text-sm font-semibold text-white uppercase tracking-wider">
                        <a href="#" class="hover:text-pink-300 transition">Home</a>
                        <a href="#product-section" class="hover:text-pink-300 transition">Shop</a>
                        <a href="#" class="hover:text-pink-300 transition">New Arrivals</a>
                        <a href="#" class="hover:text-pink-300 transition">Sale</a>
                    </nav>

                    <!-- Icons -->
                    <div class="flex items-center space-x-5 sm:space-x-6 ml-10">
                        <button id="search-icon-btn" class="text-white hover:text-pink-300 transition"><i class="fas fa-search text-xl"></i></button>
                        <a href="#" id="wishlist-icon" class="text-white hover:text-pink-300 transition relative">
                           <i class="fas fa-heart text-xl"></i>
                            <span id="wishlist-counter" class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                        </a>
                        <a href="#" id="cart-icon" class="text-white hover:text-pink-300 transition relative">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cart-counter" class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                        </a>
                    </div>
                </div>
                
                <!-- Header Search Bar (Initially Hidden) -->
                <div id="header-search-container" class="hidden items-center justify-end flex-grow">
                     <div class="relative w-full max-w-md">
                        <input type="text" id="header-search-bar" placeholder="Search and press enter..." class="w-full bg-transparent border-b-2 border-white py-2 pr-10 text-white placeholder-gray-300 focus:outline-none focus:border-pink-300 transition">
                        <button id="close-header-search-btn" class="absolute right-0 top-1/2 -translate-y-1/2 text-white hover:text-pink-300 text-2xl">
                            &times;
                        </button>
                     </div>
                </div>

            </div>
        </div>
    </header>
    
    <!-- Hero Section -->
    <section class="h-[600px] md:h-screen bg-cover bg-center flex items-center justify-center text-center text-white" style="background-image: url('https://images.unsplash.com/photo-1509319117193-57bab727e09d?q=80&w=1974&auto=format&fit=crop');">
        <div class="absolute inset-0 bg-black bg-opacity-40"></div>
        <div class="relative z-10 px-4">
            <h1 class="text-5xl md:text-7xl font-bold mb-4" style="font-family: 'Playfair Display', serif;">Discover Your Style</h1>
            <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Timeless pieces, modern essentials. Curated for you.</p>
            <a href="#product-section" class="bg-white text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-gray-200 transition-transform duration-300 transform hover:scale-105">Shop The Collection</a>
        </div>
    </section>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 -mt-24 relative z-10">
        
        <!-- Mid-page Feature Banner -->
        <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl mb-12 overflow-hidden shadow-lg">
            <div class="flex flex-col md:flex-row items-center">
                <div class="w-full md:w-1/2">
                    <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1999&auto=format&fit=crop" alt="Featured Collection" class="w-full h-full object-cover">
                </div>
                <div class="w-full md:w-1/2 text-center p-8 md:p-12">
                    <h1 class="text-3xl md:text-4xl text-gray-800 mb-4" style="font-family: 'Playfair Display', serif;">Featured Collection</h1>
                    <p class="text-md text-gray-600">Discover our latest and greatest products, handpicked for this season.</p>
                </div>
            </div>
        </div>

        <!-- Category Carousel -->
        <div class="relative mb-12 min-h-[14rem]">
            <div id="category-grid" class="flex space-x-6 overflow-x-auto py-4 scrollbar-hide">
                <div id="category-loader" class="w-full flex justify-center items-center"><div class="loader"></div></div>
            </div>
        </div>

         <!-- Product Grid -->
        <div id="product-section">
             <div class="flex justify-center items-center mb-8 gap-4 flex-wrap">
                <h2 id="product-grid-title" class="text-3xl font-bold text-gray-800" style="font-family: 'Playfair Display', serif;">Popular Products</h2>
            </div>
            <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6 min-h-[300px] relative">
                <div id="product-loader" class="absolute inset-0 flex justify-center items-center bg-gray-50 bg-opacity-80"><div class="loader"></div></div>
            </div>
             <div id="view-all-container" class="text-center mt-8 hidden">
                <button id="view-all-btn" class="bg-gray-800 text-white rounded-full px-8 py-3 font-semibold hover:bg-pink-700 transition">View All Products</button>
            </div>
        </div>
    </main>
    
    <!-- Footer, Modals, etc. -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
             <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-bold mb-4">Shop</h3>
                    <ul>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">New Arrivals</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">All Products</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Collections</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Sale</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Customer Service</h3>
                    <ul>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Contact Us</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">FAQs</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Shipping</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Returns</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">About Us</h3>
                    <ul>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Our Story</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Blog</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-pink-400">Careers</a></li>
                    </ul>
                </div>
                 <div>
                    <h3 class="font-bold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-xl hover:text-pink-400"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-xl hover:text-pink-400"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-xl hover:text-pink-400"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-xl hover:text-pink-400"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
             </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400">
                &copy; 2025 Your Company Name. All Rights Reserved.
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div id="cart-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden opacity-0"></div>
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white shadow-xl z-50 transform translate-x-full flex flex-col">
        <div class="flex items-center justify-between p-4 border-b">
            <h2 class="text-lg font-bold text-gray-800">Shopping Cart</h2>
            <button id="close-cart-btn" class="text-gray-600 hover:text-pink-600"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div id="cart-items" class="flex-grow p-4 overflow-y-auto"></div>
        <div class="p-4 border-t">
            <div class="flex justify-between items-center mb-4">
                <span class="text-lg font-semibold text-gray-800">Subtotal</span>
                <span id="cart-subtotal" class="text-lg font-bold text-gray-900">₹0.00</span>
            </div>
            <button class="w-full bg-pink-600 text-white rounded-lg py-3 font-semibold hover:bg-pink-700 transition">Proceed to Checkout</button>
        </div>
    </div>
    
    <!-- Wishlist Sidebar -->
    <div id="wishlist-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden opacity-0"></div>
    <div id="wishlist-sidebar" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white shadow-xl z-50 transform translate-x-full flex flex-col">
        <div class="flex items-center justify-between p-4 border-b">
            <h2 class="text-lg font-bold text-gray-800">Your Wishlist</h2>
            <button id="close-wishlist-btn" class="text-gray-600 hover:text-pink-600"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div id="wishlist-items" class="flex-grow p-4 overflow-y-auto"></div>
    </div>

    <!-- Product Detail Modal -->
    <div id="product-modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 hidden opacity-0"></div>
    <div id="product-modal" class="modal fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 max-w-4xl bg-white rounded-lg shadow-xl z-50 hidden transform scale-95"></div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 text-white py-2 px-4 rounded-lg shadow-lg transform translate-y-20 opacity-0 z-50">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="toast-message">Item added to cart!</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // --- HEADER SCROLL EFFECT ---
            const header = document.getElementById('main-header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.classList.add('header-scrolled');
                } else {
                    header.classList.remove('header-scrolled');
                }
            });

            // --- IN-HEADER SEARCH ---
            const searchIconBtn = document.getElementById('search-icon-btn');
            const headerMainContent = document.getElementById('header-main-content');
            const headerSearchContainer = document.getElementById('header-search-container');
            const closeHeaderSearchBtn = document.getElementById('close-header-search-btn');
            const headerSearchBar = document.getElementById('header-search-bar');

            searchIconBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                headerMainContent.classList.add('hidden');
                headerSearchContainer.classList.remove('hidden');
                headerSearchContainer.classList.add('flex');
                headerSearchBar.focus();
            });

            const closeHeaderSearch = () => {
                headerMainContent.classList.remove('hidden');
                headerSearchContainer.classList.add('hidden');
                headerSearchContainer.classList.remove('flex');
            };

            closeHeaderSearchBtn.addEventListener('click', closeHeaderSearch);

            headerSearchBar.addEventListener('keydown', (e) => {
                if(e.key === 'Enter' && e.target.value.trim() !== '') {
                    const searchTerm = e.target.value.toLowerCase();
                    renderProducts(products.filter(p => p.name.toLowerCase().includes(searchTerm)));
                    productGridTitle.textContent = `Results for "${searchTerm}"`;
                    viewAllContainer.classList.remove('hidden');
                    document.getElementById('product-section').scrollIntoView({ behavior: 'smooth' });
                    closeHeaderSearch();
                }
            });

            // --- GLOBAL STATE & SELECTORS ---
            let products = [];
            let categories = [];
            let cart = [];
            let wishlist = [];

            const productGrid = document.getElementById('product-grid');
            const categoryGrid = document.getElementById('category-grid');
            const productGridTitle = document.getElementById('product-grid-title');
            const viewAllContainer = document.getElementById('view-all-container');
            const viewAllBtn = document.getElementById('view-all-btn');
            const cartIcon = document.getElementById('cart-icon');
            const cartSidebar = document.getElementById('cart-sidebar');
            const cartOverlay = document.getElementById('cart-overlay');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartItemsContainer = document.getElementById('cart-items');
            const productModal = document.getElementById('product-modal');
            const productModalOverlay = document.getElementById('product-modal-overlay');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const productLoader = document.getElementById('product-loader');
            const categoryLoader = document.getElementById('category-loader');
            const wishlistIcon = document.getElementById('wishlist-icon');
            const wishlistSidebar = document.getElementById('wishlist-sidebar');
            const wishlistOverlay = document.getElementById('wishlist-overlay');
            const closeWishlistBtn = document.getElementById('close-wishlist-btn');
            const wishlistItemsContainer = document.getElementById('wishlist-items');
            
            // --- API FETCH & DATA PROCESSING ---
            async function fetchProducts() {
                try {
                    const response = await fetch('https://fakestoreapi.com/products');
                    const data = await response.json();
                    products = data.map(p => ({
                        id: p.id, name: p.title, price: Math.round(p.price * 80), img: p.image, oldPrice: Math.round(p.price * 80 * 1.5),
                        category: p.category === 'jewelery' ? 'jewelry' : p.category, description: p.description
                    }));
                    categories = ['All', ...new Set(products.map(p => p.category))];
                    categories.push('Sale');
                } catch (error) {
                    console.error("Failed to fetch products:", error);
                    productGrid.innerHTML = `<p class="col-span-full text-center text-red-500">Could not load products.</p>`;
                }
            }

            // --- RENDER FUNCTIONS ---
            const renderProducts = (productsToRender) => {
                productLoader.style.display = 'none';
                productGrid.innerHTML = '';
                if (productsToRender.length === 0) {
                    productGrid.innerHTML = `<p class="col-span-full text-center text-gray-500">No products found.</p>`;
                    return;
                }
                productsToRender.forEach(prod => {
                    const isWishlisted = wishlist.includes(prod.id);
                    const productElement = document.createElement('div');
                    productElement.className = 'bg-white rounded-lg shadow-sm overflow-hidden group transition-transform duration-300 hover:scale-105 hover:shadow-xl';
                    productElement.innerHTML = `
                        <div class="relative">
                            <div class="product-card-top cursor-pointer" data-product-id="${prod.id}">
                               <img src="${prod.img}" alt="${prod.name}" class="w-full h-full object-contain aspect-square p-4 bg-white">
                            </div>
                            <div class="absolute top-2 right-2">
                                <button class="wishlist-btn bg-white rounded-full h-8 w-8 flex items-center justify-center text-gray-600 hover:text-pink-500 transition" data-product-id="${prod.id}">
                                    <i class="fa-${isWishlisted ? 'solid' : 'regular'} fa-heart"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-3 text-center">
                            <h3 class="text-sm font-medium text-gray-800 truncate product-card-top cursor-pointer" data-product-id="${prod.id}">${prod.name}</h3>
                            <div class="flex items-baseline justify-center space-x-2 mt-1">
                                <p class="text-md font-bold text-gray-900">₹${prod.price.toLocaleString('en-IN')}</p>
                            </div>
                            <button data-product-id="${prod.id}" class="add-to-cart-btn w-full mt-3 bg-gray-800 text-white rounded-full py-2 text-sm font-semibold hover:bg-pink-600 transition">
                                Add to Cart
                            </button>
                        </div>
                    `;
                    productGrid.appendChild(productElement);
                });
                updateWishlistDisplay();
            };
            
            const categoryImages = {
                'All': 'https://images.unsplash.com/photo-1551488831-00ddcb6c6bd3?q=80&w=2070&auto=format&fit=crop',
                "men's clothing": 'https://images.unsplash.com/photo-1617137968427-85924c800a22?q=80&w=1964&auto=format&fit=crop',
                "jewelry": 'https://images.unsplash.com/photo-1611652033935-a7b53994dba9?q=80&w=1974&auto=format&fit=crop',
                "electronics": 'https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?q=80&w=1964&auto=format&fit=crop',
                "women's clothing": 'https://images.unsplash.com/photo-1572804013427-4d7ca7268217?q=80&w=1965&auto=format&fit=crop',
                'Sale': 'https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=2070&auto=format&fit=crop'
            };

            const renderCategories = () => {
                categoryLoader.style.display = 'none';
                categoryGrid.innerHTML = '';
                categories.forEach(cat => {
                    const isActive = cat === 'All';
                    const categoryElement = document.createElement('div');
                    const formattedCat = cat.charAt(0).toUpperCase() + cat.slice(1);
                    categoryElement.className = `category-item flex-shrink-0 group cursor-pointer w-80 h-96`;
                    categoryElement.dataset.category = cat;
                    if (isActive) categoryElement.classList.add('active-category');
                    categoryElement.innerHTML = `
                        <div class="relative rounded-xl overflow-hidden h-full shadow-lg transition-transform duration-300 transform group-hover:-translate-y-2">
                            <img src="${categoryImages[cat] || 'https://placehold.co/400x520/cccccc/333?text=Other'}" alt="${cat}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center p-2 text-center">
                                <h3 class="text-white font-bold text-lg sm:text-xl">${formattedCat}</h3>
                            </div>
                             <div class="absolute inset-0 rounded-xl pointer-events-none"></div>
                        </div>
                    `;
                    categoryGrid.appendChild(categoryElement);
                });
            };

            // --- CART & WISHLIST & MODAL LOGIC ---
            const updateCartDisplay = () => {
                const cartCounter = document.getElementById('cart-counter');
                const subtotalEl = document.getElementById('cart-subtotal');
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = `<div id="empty-cart-message" class="text-center text-gray-500 mt-8"><i class="fas fa-shopping-cart text-4xl mb-4"></i><p>Your cart is empty.</p></div>`;
                } else {
                    cart.forEach(item => {
                        const product = products.find(p => p.id === item.id);
                        const cartItemEl = document.createElement('div');
                        cartItemEl.className = 'flex items-center space-x-4 mb-4';
                        cartItemEl.innerHTML = `<img src="${product.img}" alt="${product.name}" class="w-16 h-16 rounded-md object-contain bg-white p-1 border"><div class="flex-grow"><p class="text-sm font-medium text-gray-800">${product.name}</p><p class="text-xs text-gray-500">₹${product.price.toLocaleString('en-IN')}</p><div class="flex items-center mt-2"><button data-id="${item.id}" class="cart-quantity-btn dec-btn bg-gray-200 rounded-l px-2 py-1 text-sm">-</button><span class="px-3 py-1 bg-gray-100 text-sm">${item.quantity}</span><button data-id="${item.id}" class="cart-quantity-btn inc-btn bg-gray-200 rounded-r px-2 py-1 text-sm">+</button></div></div><div><p class="text-sm font-bold">₹${(product.price * item.quantity).toLocaleString('en-IN')}</p><button data-id="${item.id}" class="remove-item-btn text-red-500 hover:text-red-700 text-xs mt-1">Remove</button></div>`;
                        cartItemsContainer.appendChild(cartItemEl);
                    });
                }
                const subtotal = cart.reduce((total, item) => total + (products.find(p => p.id === item.id).price * item.quantity), 0);
                subtotalEl.textContent = `₹${subtotal.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCounter.textContent = totalItems;
                cartCounter.classList.toggle('hidden', totalItems === 0);
            };
            
            const showToast = (message) => {
                toastMessage.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 2000);
            }

            const addToCart = (productId) => {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) existingItem.quantity++;
                else cart.push({ id: productId, quantity: 1 });
                const product = products.find(p => p.id === productId);
                showToast(`'${product.name}' added to cart!`);
                updateCartDisplay();
            }
            
            const openCart = () => {
                cartOverlay.classList.remove('hidden');
                setTimeout(() => { cartOverlay.classList.remove('opacity-0'); cartSidebar.classList.remove('translate-x-full'); }, 10);
            }

            const closeCart = () => {
                cartOverlay.classList.add('opacity-0');
                cartSidebar.classList.add('translate-x-full');
                setTimeout(() => cartOverlay.classList.add('hidden'), 300);
            }

            const toggleWishlist = (productId) => {
                const index = wishlist.indexOf(productId);
                if (index > -1) wishlist.splice(index, 1);
                else wishlist.push(productId);
                updateWishlistDisplay();
            }
            
            const updateWishlistDisplay = () => {
                 wishlistItemsContainer.innerHTML = '';
                 if(wishlist.length === 0) {
                    wishlistItemsContainer.innerHTML = `<div id="empty-wishlist-message" class="text-center text-gray-500 mt-8"><i class="fas fa-heart text-4xl mb-4"></i><p>Your wishlist is empty.</p></div>`;
                 } else {
                    wishlist.forEach(productId => {
                        const product = products.find(p => p.id === productId);
                        const wishlistItemEl = document.createElement('div');
                        wishlistItemEl.className = 'flex items-start space-x-4 mb-4';
                        wishlistItemEl.innerHTML = `<img src="${product.img}" alt="${product.name}" class="w-16 h-16 rounded-md object-contain p-1 border bg-white"><div class="flex-grow"><p class="text-sm font-medium text-gray-800">${product.name}</p><p class="text-sm font-bold text-gray-600">₹${product.price.toLocaleString('en-IN')}</p></div><div class="flex flex-col items-end space-y-1"><button data-product-id="${product.id}" class="add-to-cart-btn text-pink-500 hover:text-pink-700 text-xs whitespace-nowrap">Add to Cart</button><button data-id="${product.id}" class="remove-wishlist-item-btn text-red-500 hover:text-red-700 text-xs">Remove</button></div>`;
                        wishlistItemsContainer.appendChild(wishlistItemEl);
                    });
                 }
                const wishlistCounter = document.getElementById('wishlist-counter');
                wishlistCounter.textContent = wishlist.length;
                wishlistCounter.classList.toggle('hidden', wishlist.length === 0);
                document.querySelectorAll('.wishlist-btn').forEach(btn => {
                    const productId = parseInt(btn.dataset.productId);
                    btn.innerHTML = `<i class="fa-${wishlist.includes(productId) ? 'solid' : 'regular'} fa-heart"></i>`;
                });
            }
            
            const openProductModal = (productId) => {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                productModal.innerHTML = `<button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 z-10"><i class="fas fa-times text-2xl"></i></button><div class="flex flex-col md:flex-row max-h-[90vh] overflow-y-auto"><div class="w-full md:w-1/2 p-4 flex justify-center items-center bg-white"><img src="${product.img}" alt="${product.name}" class="w-full max-w-sm rounded-lg object-contain"></div><div class="w-full md:w-1/2 p-6 flex flex-col justify-center"><h2 class="text-2xl font-bold text-gray-800 mb-2">${product.name}</h2><p class="text-gray-500 mb-4 capitalize">${product.category}</p><div class="flex items-baseline space-x-3 mb-4"><p class="text-3xl font-bold text-pink-600">₹${product.price.toLocaleString('en-IN')}</p><p class="text-xl text-gray-400 line-through">₹${product.oldPrice.toLocaleString('en-IN')}</p></div><p class="text-gray-600 mb-6 text-sm">${product.description}</p><button data-product-id="${product.id}" class="add-to-cart-btn w-full bg-pink-600 text-white rounded-lg py-3 text-lg font-semibold hover:bg-pink-700 transition">Add to Cart</button></div></div>`;
                productModal.classList.remove('hidden', 'scale-95');
                productModalOverlay.classList.remove('hidden', 'opacity-0');
                document.getElementById('close-modal-btn').addEventListener('click', closeProductModal);
            }

            const closeProductModal = () => {
                productModal.classList.add('scale-95');
                productModalOverlay.classList.add('opacity-0');
                setTimeout(() => { productModal.classList.add('hidden'); productModalOverlay.classList.add('hidden'); }, 300);
            }

            // --- EVENT LISTENERS ---
            categoryGrid.addEventListener('click', (e) => {
                const categoryItem = e.target.closest('.category-item');
                if (categoryItem) {
                    const selectedCategory = categoryItem.dataset.category;
                    document.querySelectorAll('.category-item').forEach(ci => ci.classList.remove('active-category'));
                    categoryItem.classList.add('active-category');
                    productLoader.style.display = 'flex';
                    setTimeout(() => {
                        let productsToRender;
                        let title;

                        if (selectedCategory === 'All') {
                            productsToRender = products;
                            title = 'Popular Products';
                        } else if (selectedCategory === 'Sale') {
                            productsToRender = products.filter(p => p.oldPrice && p.price < p.oldPrice);
                            title = 'On Sale';
                        } else {
                            productsToRender = products.filter(p => p.category === selectedCategory);
                            title = selectedCategory.charAt(0).toUpperCase() + selectedCategory.slice(1);
                        }
                        
                        renderProducts(productsToRender);
                        productGridTitle.textContent = title;
                        viewAllContainer.classList.toggle('hidden', selectedCategory === 'All');
                    }, 300);
                }
            });

            viewAllBtn.addEventListener('click', () => {
                renderProducts(products);
                productGridTitle.textContent = 'Popular Products';
                viewAllContainer.classList.add('hidden');
                document.querySelectorAll('.category-item').forEach(ci => ci.classList.remove('active-category'));
                document.querySelector('.category-item[data-category="All"]').classList.add('active-category');
            });
            
            productGrid.addEventListener('click', e => {
                const target = e.target.closest('[data-product-id]');
                if (!target) return;
                const productId = parseInt(target.dataset.productId);
                if (target.closest('.add-to-cart-btn')) addToCart(productId);
                else if (target.closest('.wishlist-btn')) toggleWishlist(productId);
                else if (target.closest('.product-card-top')) openProductModal(productId);
            });

            productModal.addEventListener('click', e => {
                if (e.target.closest('.add-to-cart-btn')) addToCart(parseInt(e.target.closest('[data-product-id]').dataset.productId));
            });
            
            productModalOverlay.addEventListener('click', closeProductModal);
            cartIcon.addEventListener('click', openCart);
            closeCartBtn.addEventListener('click', closeCart);
            cartOverlay.addEventListener('click', closeCart);
            cartItemsContainer.addEventListener('click', e => {
                const target = e.target.closest('[data-id]');
                if (!target) return;
                const productId = parseInt(target.dataset.id);
                const item = cart.find(i => i.id === productId);
                if (!item) return;
                if (target.closest('.cart-quantity-btn')) {
                    if (target.closest('.inc-btn')) item.quantity++;
                    else if (target.closest('.dec-btn')) {
                        item.quantity--;
                        if (item.quantity === 0) cart = cart.filter(i => i.id !== productId);
                    }
                } else if (target.closest('.remove-item-btn')) cart = cart.filter(i => i.id !== productId);
                updateCartDisplay();
            });
            
            wishlistIcon.addEventListener('click', () => {
                wishlistOverlay.classList.remove('hidden');
                setTimeout(() => { wishlistOverlay.classList.remove('opacity-0'); wishlistSidebar.classList.remove('translate-x-full'); }, 10);
            });
            
            const closeWishlist = () => {
                wishlistOverlay.classList.add('opacity-0');
                wishlistSidebar.classList.add('translate-x-full');
                setTimeout(() => wishlistOverlay.classList.add('hidden'), 300);
            }
            closeWishlistBtn.addEventListener('click', closeWishlist);
            wishlistOverlay.addEventListener('click', closeWishlist);

            wishlistItemsContainer.addEventListener('click', e => {
                const removeBtn = e.target.closest('.remove-wishlist-item-btn');
                const addBtn = e.target.closest('.add-to-cart-btn');
                if (removeBtn) toggleWishlist(parseInt(removeBtn.dataset.id));
                else if (addBtn) addToCart(parseInt(addBtn.dataset.productId));
            });

            // --- INITIALIZATION ---
            async function initializeApp() {
                await fetchProducts();
                renderCategories();
                renderProducts(products);
                updateCartDisplay();
                updateWishlistDisplay();
            }

            initializeApp();
        });
    </script>
</body>
</html>

